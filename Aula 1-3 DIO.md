---


---

<blockquote>
<p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>
<h3 id="internet-das-coisas">Internet das Coisas</h3>
<p>A internet das coisas surge quando objetos normais conectam a rede mundial de computadores para enviar e receber informações.</p>
<p>E por que conectar as coisas?</p>
<p>Embutir sensores em objetos do dia a dia como eletrodomésticos, carros, nas ruas e no campo para coletar dados destes sensores, como dados de clima, quantidade de pessoas para tomar decisões com base nos dados coletados.</p>
<p>Conceitos básicos de IoT (sigla em inglês para internet das coisas - <em>internet of things</em>): as coisas (<em>things</em>) que são os objetos utilizados; a <em>Cloud</em> onde os dados ficam e a Inteligência que são o tratamento e a posterior tomada de decisão.</p>
<p><em>Smart Building</em> é um exemplo de aplicação de IoT. Podemos ter informações do sistema de tubulação, sistema elétrico, os detectores de fumaça, as garagens, as catracas de entrada e saída e as câmeras de segurança. Podemos utilizar o IOT para melhorar a segurança através dos dados da câmera do prédio, ou um melhor prevenção de incêndios através dos sensores de fumaça.</p>
<p>O <em>Smart Home</em> é semelhante ao <em>Smart Building</em> em uma escala menor. Podemos coletar  dados através de sensores de temperatura, de presença, alarmes e iluminação. O <em>Smart Home</em> é mais focado em medir a presença do morador na casa. Podemos utilizar um sensor de temperatura para ligar automaticamente o ar condicionado em reação à temperatura externa.</p>
<p><em>Wearables</em> têm se tornado comuns. Um relógio <em>smart</em> pode coletar dados sobre saúde, de pagamentos e de hábitos de seu usuário.</p>
<p>Na Agricultura a IOT também tem espaço. Em uma plantação podemos implantar sensores de umidade do solo para poder decidir sobre a irrigação. No Transporte já temos exemplos de carros que coletam dados sobre o trânsito e até mesmo carros autônomos como na Tesla.</p>
<p>Podemos considerar o nascimento do IOT no RFID <em>Supply Chain</em>. Consiste em aplicar uma etiqueta em um produto que reporta o estado ou etapa na cadeia de produção por sensores que leem a etiqueta e reportam a um servidor centralizado. O produto também pode ser facilmente rastreado por esta etiqueta.</p>
<p>Com IOT também podemos coletar dados de fontes geradoras e consumidoras de energia, gerando dados importantes para a tomada de decisão.</p>
<h4 id="desafios">Desafios</h4>
<p>Um problema maior a ser resolvido é a privacidade e a segurança. Não é possível garantir que um <em>device</em> seja imune a ser hackeado ou comprometido.</p>
<p>Outro desafio é a quantidade exponencial de dispositivos conectadas à rede. Isso leva consigo algums problemas. Empresas não estão acostumadas a trabalhar com tantas fontes de dados, onde é necessária receber, tratar e entender os dados coletados. E também é preciso gerar valor a partir dos dados coletados. Coletar dados não deve ser um fim em si mesmo -é necessário ter um propósito para a análise dos dados.</p>
<h3 id="arquitetura-da-iot">Arquitetura da IOT</h3>
<p>Precisamos pensar como conectar as coisas para resolver problemas. Atualmente temos diversas opções para conectar objetos, desde soluções caseiras, industriais e produtos <em>out-of-the-box</em> como lâmpadas, tomadas inteligentes  com sistemas de sensores.</p>
<p>Precisamos levar em conta algumas coisas para escolher a forma que iremos coletar os dados. Precisamos de um dispostivo com baixo consumo de energia (pois o dispositivo irá ser hospedado pelo alvo). Temos de pensar também na rede de dados nos locais onde o dispositivo estará localizado e observar como ele lidará com dados limitados. O <em>device</em> deve ser resiliente e ser capaz de operar com baixa energia e rede, como <em>buffers</em> locais para armazenar os dados enquanto a rede está <em>offline</em>. A segurança é essencial para soluções críticas ou produtos escalonados de forma industrial. Customização é importante, pois os ambientes que o <em>device</em> encontrará serão heterogêneos, além de diversos fornecedores e clientes, independente do hardware. O custo deve ser minimizado, dado o contexto de futuramente bilhões de dispotivios estarem conectados no futuro.</p>
<p>O <strong>Arduino</strong> é um device utilizado para prototipagem. Por si próprio não possui conectividade, mas possui <em>shields</em> que podem ser utilizados para conexão wi-fi.</p>
<p>Para ter mais garantia na coleta de dados são utilizados <strong>embarcadores</strong> (MCUs). São microcontroladores de chip único, com sistema operacional em tempo real embarcados diretamente no dispositivo.</p>
<p>Outro <em>device</em> utilizado nos projetos de IOT é o <strong>Raspberry PI</strong>, que é um computador completo. Possui processador, memória, entradas e saídas USB e HDMI, pode rodar SO Linux ou Windows. Pode ser utilizado domesticamente como um computador normal. A principal vantagem é poder trabalhar com linguagens de alto nível e não precisar baixar para um C++ ou C como nos MCUs ou o Arduino.</p>
<h4 id="protocolo-de-iot">Protocolo de IOT</h4>
<p>O protocolo utilizado pelo IOT é o MQTT (<em>Message Queue Telemetric Transport</em>). Foi criado pela IBM para conectar sensores de pipelines de petróleo a satérlites. É um protcolo de mensagens assíncronas, onde o device envia e não aguarda uma resposta (M2M). É base na pilha de TCP/IP. Seu padrão é o OASIS, suportado pelas linguagens de programação mais populares.</p>
<p>Vamos rever rapidamente o modelo cliente-servidor:</p>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-vXmELqhuhRvnFSGg" width="100%" style="max-width: 269.3666687011719px;" viewBox="0 0 269.3666687011719 89.43331909179688"><g transform="translate(-12, -12)"><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M81.30000305175781,48.51269299921848L137.9166717529297,33.35832977294922L194.53334045410156,47.12928595315112" marker-end="url(#arrowhead4973)" style="fill:none"></path><defs><marker id="arrowhead4973" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M194.53334045410156,66.30403313864576L137.9166717529297,80.07498931884766L81.30000305175781,64.92062609257839" marker-end="url(#arrowhead4974)" style="fill:none"></path><defs><marker id="arrowhead4974" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" style="opacity: 1;" transform="translate(137.9166717529297,33.35832977294922)"><g transform="translate(-26.474998474121094,-13.358329772949219)" class="label"><foreignObject width="52.94999694824219" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">request</span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform="translate(137.9166717529297,80.07498931884766)"><g transform="translate(-31.616668701171875,-13.358329772949219)" class="label"><foreignObject width="63.23333740234375" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">response</span></div></foreignObject></g></g></g><g class="nodes"><g class="node" style="opacity: 1;" id="a" transform="translate(50.650001525878906,56.71665954589844)"><rect rx="5" ry="5" x="-30.650001525878906" y="-23.35832977294922" width="61.30000305175781" height="46.71665954589844"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-20.650001525878906,-13.358329772949219)"><foreignObject width="41.30000305175781" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Client</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="b" transform="translate(233.95000457763672,56.71665954589844)"><rect rx="0" ry="0" x="-39.416664123535156" y="-23.35832977294922" width="78.83332824707031" height="46.71665954589844"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-29.416664123535156,-13.358329772949219)"><foreignObject width="58.83332824707031" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Servidor</div></foreignObject></g></g></g></g></g></g></svg></div>
<p>O modelo é de comunicação síncrona, onde o cliente envia uma request e aguarda uma resposta do servidor através do protocolo HTTP.</p>
<p>No modelo MQTT, temos os publicadores de mensagens para um <em>broker</em> especializado em receber a mensagem, que entrega para um destinatário que estão inscritos para receber esta mensagem.</p>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-uZXT4mX8zVhuxGOC" width="100%" style="max-width: 481.9833068847656px;" viewBox="0 0 481.9833068847656 89.43331909179688"><g transform="translate(-12, -12)"><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M69.96665954589844,56.71665954589844L120.1333236694336,56.71665954589844L170.29998779296875,56.71665954589844" marker-end="url(#arrowhead4991)" style="fill:none"></path><defs><marker id="arrowhead4991" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M286.63331604003906,45.04334814139868L344.85831451416016,33.35832977294922L403.08331298828125,47.00306293420949" marker-end="url(#arrowhead4992)" style="fill:none"></path><defs><marker id="arrowhead4992" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M403.08331298828125,66.4302561575874L344.85831451416016,80.07498931884766L286.63331604003906,68.3899709503982" marker-end="url(#arrowhead4993)" style="fill:none"></path><defs><marker id="arrowhead4993" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" style="opacity: 1;" transform="translate(120.1333236694336,56.71665954589844)"><g transform="translate(-25.166664123535156,-13.358329772949219)" class="label"><foreignObject width="50.33332824707031" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">publish</span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform="translate(344.85831451416016,33.35832977294922)"><g transform="translate(-25.166664123535156,-13.358329772949219)" class="label"><foreignObject width="50.33332824707031" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">publish</span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform="translate(344.85831451416016,80.07498931884766)"><g transform="translate(-33.224998474121094,-13.358329772949219)" class="label"><foreignObject width="66.44999694824219" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">subscribe</span></div></foreignObject></g></g></g><g class="nodes"><g class="node" style="opacity: 1;" id="a" transform="translate(44.98332977294922,56.71665954589844)"><rect rx="0" ry="0" x="-24.98332977294922" y="-23.35832977294922" width="49.96665954589844" height="46.71665954589844"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-14.983329772949219,-13.358329772949219)"><foreignObject width="29.966659545898438" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">GPS</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="b" transform="translate(228.4666519165039,56.71665954589844)"><rect rx="5" ry="5" x="-58.166664123535156" y="-23.35832977294922" width="116.33332824707031" height="46.71665954589844"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-48.166664123535156,-13.358329772949219)"><foreignObject width="96.33332824707031" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">MQTT Broker</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="c" transform="translate(444.53330993652344,56.71665954589844)"><rect rx="5" ry="5" x="-41.44999694824219" y="-23.35832977294922" width="82.89999389648438" height="46.71665954589844"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-31.449996948242188,-13.358329772949219)"><foreignObject width="62.899993896484375" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">database</div></foreignObject></g></g></g></g></g></g></svg></div>
<p>Para publicar é necessário ter o enderço do <em>Broker</em>. Um exemplo é um GPS que envia a informação de localização para um endereço.</p>
<p>Um enderço MQTT é composto por diversos tópicos.<br>
Um exemplo de endereço MQTT pode ser:</p>
<pre><code>mqtt://broker.io/a6g319/gps/position
</code></pre>
<p>O primeiro tópico é o protocolo, o segundo é o endereço do <em>broker</em>, o terceiro é o identificador do usuário, o quarto é o sensor (GPS, acelerômetro, sensor de temperatura) e o último é o dado especializado do sensor (localização, velociade, temperatura)</p>
<p>O sensor irá conseguir a informação e publicar a informação ao broker.</p>
<pre><code>pub mqtt://broker.io/se3kfo/acelerometer/velocity
</code></pre>
<p>Em retorno, para consumir esta informação o client deve ter a capacidade de se conectar ao <em>broker</em> para ouvir o tópico.</p>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-HJkNskHhnkdmbcPL" width="100%" style="max-width: 310.0833282470703px;" viewBox="0 0 310.0833282470703 89.43331909179688"><g transform="translate(-12, -12)"><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M136.3333282470703,45.04334814139868L194.5583267211914,33.35832977294922L252.7833251953125,48.66115638772261" marker-end="url(#arrowhead5004)" style="fill:none"></path><defs><marker id="arrowhead5004" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M252.7833251953125,64.77216270407426L194.5583267211914,80.07498931884766L136.3333282470703,68.3899709503982" marker-end="url(#arrowhead5005)" style="fill:none"></path><defs><marker id="arrowhead5005" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" style="opacity: 1;" transform="translate(194.5583267211914,33.35832977294922)"><g transform="translate(-25.166664123535156,-13.358329772949219)" class="label"><foreignObject width="50.33332824707031" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">publish</span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform="translate(194.5583267211914,80.07498931884766)"><g transform="translate(-33.224998474121094,-13.358329772949219)" class="label"><foreignObject width="66.44999694824219" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">subscribe</span></div></foreignObject></g></g></g><g class="nodes"><g class="node" style="opacity: 1;" id="b" transform="translate(78.16666412353516,56.71665954589844)"><rect rx="5" ry="5" x="-58.166664123535156" y="-23.35832977294922" width="116.33332824707031" height="46.71665954589844"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-48.166664123535156,-13.358329772949219)"><foreignObject width="96.33332824707031" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">MQTT Broker</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="c" transform="translate(283.4333267211914,56.71665954589844)"><rect rx="5" ry="5" x="-30.650001525878906" y="-23.35832977294922" width="61.30000305175781" height="46.71665954589844"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-20.650001525878906,-13.358329772949219)"><foreignObject width="41.30000305175781" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Client</div></foreignObject></g></g></g></g></g></g></svg></div>
<p>Um comando de <code>sub</code> pode ser formatado assim:</p>
<pre><code>sub mqtt://broker.io/user/gps/+
</code></pre>
<p>Esta inscrição solicita todas as informações de velocidade de um usuário.</p>
<pre><code>sub mqtt://broker.io/+/#
</code></pre>
<p>Este comando inscreve o cliente para ouvir todas as informações de todos os sensores.</p>
<p>Há também níveís de garantia para que a informação transmitida seja de qualidade.</p>
<ul>
<li>Nível 0 (QoS 0)<br>
Possui o menor nível de esforço. A mensagem não é armazenada para a retransmissão e não há garantia de entrega. É o nível mais barato.</li>
</ul>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-HgvaakbLsonl5SwP" width="100%" style="max-width: 343.63331604003906px;" viewBox="0 0 343.63331604003906 62.71665954589844"><g transform="translate(-12, -12)"><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M130.96665954589844,43.35832977294922L181.1333236694336,43.35832977294922L231.29998779296875,43.35832977294922" marker-end="url(#arrowhead5013)" style="fill:none"></path><defs><marker id="arrowhead5013" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" style="opacity: 1;" transform="translate(181.1333236694336,43.35832977294922)"><g transform="translate(-25.166664123535156,-13.358329772949219)" class="label"><foreignObject width="50.33332824707031" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">publish</span></div></foreignObject></g></g></g><g class="nodes"><g class="node" style="opacity: 1;" id="A" transform="translate(75.48332977294922,43.35832977294922)"><rect rx="5" ry="5" x="-55.48332977294922" y="-23.35832977294922" width="110.96665954589844" height="46.71665954589844"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-45.48332977294922,-13.358329772949219)"><foreignObject width="90.96665954589844" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">MQTT Client</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="B" transform="translate(289.4666519165039,43.35832977294922)"><rect rx="5" ry="5" x="-58.166664123535156" y="-23.35832977294922" width="116.33332824707031" height="46.71665954589844"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-48.166664123535156,-13.358329772949219)"><foreignObject width="96.33332824707031" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">MQTT Broker</div></foreignObject></g></g></g></g></g></g></svg></div>
<ul>
<li>
<p>Nível 1 (QoS 1)</p>
<p>Há confirmação de entrega pelo menos uma vez ao recebedor. A mensagem é armazenada e pode ser retransmitida caso não haja confirmação de entrega. É o mecanismo padrão de segurança.</p>
</li>
</ul>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-G1Lb0Zy97t5AOWVu" width="100%" style="max-width: 343.8666534423828px;" viewBox="0 0 343.8666534423828 89.43331909179688"><g transform="translate(-12, -12)"><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M136.3333282470703,44.18852528473901L186.61666107177734,33.35832977294922L236.89999389648438,44.46329083871037" marker-end="url(#arrowhead5024)" style="fill:none"></path><defs><marker id="arrowhead5024" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M236.89999389648438,68.9700282530865L186.61666107177734,80.07498931884766L136.3333282470703,69.24479380705786" marker-end="url(#arrowhead5025)" style="fill:none"></path><defs><marker id="arrowhead5025" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" style="opacity: 1;" transform="translate(186.61666107177734,33.35832977294922)"><g transform="translate(-25.166664123535156,-13.358329772949219)" class="label"><foreignObject width="50.33332824707031" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">publish</span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform="translate(186.61666107177734,80.07498931884766)"><g transform="translate(-25.28333282470703,-13.358329772949219)" class="label"><foreignObject width="50.56666564941406" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">puback</span></div></foreignObject></g></g></g><g class="nodes"><g class="node" style="opacity: 1;" id="A" transform="translate(78.16666412353516,56.71665954589844)"><rect rx="5" ry="5" x="-58.166664123535156" y="-23.35832977294922" width="116.33332824707031" height="46.71665954589844"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-48.166664123535156,-13.358329772949219)"><foreignObject width="96.33332824707031" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">MQTT Broker</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="B" transform="translate(292.3833236694336,56.71665954589844)"><rect rx="5" ry="5" x="-55.48332977294922" y="-23.35832977294922" width="110.96665954589844" height="46.71665954589844"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-45.48332977294922,-13.358329772949219)"><foreignObject width="90.96665954589844" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">MQTT Client</div></foreignObject></g></g></g></g></g></g></svg></div>
<ul>
<li>Nível 2 (QoS 2)</li>
</ul>
<p>Tem o mesmo armazenamento do 1. Se o broker não mandar a confirmação de armazenamento da mensagem, o client reenvia a mensagem. De mesma forma, se o client não receber a confirmação que o broker recebeu e armazenou a mensagem, o broker reenvia a confirmação até ter a resposta.</p>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-UIfsDu4BQTHGqULq" width="100%" style="max-width: 358.84999084472656px;" viewBox="0 0 358.84999084472656 182.86663818359375"><g transform="translate(-12, -12)"><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M113.2361068725586,80.07498931884766L188.74166107177734,33.35832977294922L266.0361048380534,80.07498931884766" marker-end="url(#arrowhead5041)" style="fill:none"></path><defs><marker id="arrowhead5041" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M246.51666259765625,115.15193737090881L188.74166107177734,126.7916488647461L130.96665954589844,114.87616747986287" marker-end="url(#arrowhead5042)" style="fill:none"></path><defs><marker id="arrowhead5042" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M130.96665954589844,91.99047070373088L188.74166107177734,80.07498931884766L246.51666259765625,91.71470081268494" marker-end="url(#arrowhead5043)" style="fill:none"></path><defs><marker id="arrowhead5043" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M266.0361048380534,126.7916488647461L188.74166107177734,173.50830841064453L113.2361068725586,126.7916488647461" marker-end="url(#arrowhead5044)" style="fill:none"></path><defs><marker id="arrowhead5044" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" style="opacity: 1;" transform="translate(188.74166107177734,33.35832977294922)"><g transform="translate(-25.166664123535156,-13.358329772949219)" class="label"><foreignObject width="50.33332824707031" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">publish</span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform="translate(188.74166107177734,126.7916488647461)"><g transform="translate(-22.291664123535156,-13.358329772949219)" class="label"><foreignObject width="44.58332824707031" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">pubrel</span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform="translate(188.74166107177734,80.07498931884766)"><g transform="translate(-25.28333282470703,-13.358329772949219)" class="label"><foreignObject width="50.56666564941406" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">puback</span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform="translate(188.74166107177734,173.50830841064453)"><g transform="translate(-32.775001525878906,-13.358329772949219)" class="label"><foreignObject width="65.55000305175781" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">pubcomp</span></div></foreignObject></g></g></g><g class="nodes"><g class="node" style="opacity: 1;" id="A" transform="translate(75.48332977294922,103.43331909179688)"><rect rx="5" ry="5" x="-55.48332977294922" y="-23.35832977294922" width="110.96665954589844" height="46.71665954589844"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-45.48332977294922,-13.358329772949219)"><foreignObject width="90.96665954589844" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">MQTT Client</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="B" transform="translate(304.6833267211914,103.43331909179688)"><rect rx="5" ry="5" x="-58.166664123535156" y="-23.35832977294922" width="116.33332824707031" height="46.71665954589844"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-48.166664123535156,-13.358329772949219)"><foreignObject width="96.33332824707031" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">MQTT Broker</div></foreignObject></g></g></g></g></g></g></svg></div>
<h3 id="cloud">Cloud</h3>
<p>A Cloud está cada vez maior, com TBs e PBs de informações com potencial de escala global.</p>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-7IzDCFtrQxHTGj2Y" width="100%" style="max-width: 349.8833465576172px;" viewBox="0 0 349.8833465576172 62.71665954589844"><g transform="translate(-12, -12)"><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M86.66667175292969,43.35832977294922L111.66667175292969,43.35832977294922L136.6666717529297,43.35832977294922" marker-end="url(#arrowhead5056)" style="fill:none"></path><defs><marker id="arrowhead5056" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M209.15000915527344,43.35832977294922L234.15000915527344,43.35832977294922L259.15000915527344,43.35832977294922" marker-end="url(#arrowhead5057)" style="fill:none"></path><defs><marker id="arrowhead5057" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node" style="opacity: 1;" id="A" transform="translate(53.333335876464844,43.35832977294922)"><rect rx="0" ry="0" x="-33.333335876464844" y="-23.35832977294922" width="66.66667175292969" height="46.71665954589844"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-23.333335876464844,-13.358329772949219)"><foreignObject width="46.66667175292969" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Broker</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="B" transform="translate(172.90834045410156,43.35832977294922)"><rect rx="5" ry="5" x="-36.241668701171875" y="-23.35832977294922" width="72.48333740234375" height="46.71665954589844"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-26.241668701171875,-13.358329772949219)"><foreignObject width="52.48333740234375" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Worker</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="C" transform="translate(306.5166778564453,43.35832977294922)"><rect rx="5" ry="5" x="-47.366668701171875" y="-23.35832977294922" width="94.73333740234375" height="46.71665954589844"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-37.366668701171875,-13.358329772949219)"><foreignObject width="74.73333740234375" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Data Store</div></foreignObject></g></g></g></g></g></g></svg></div>
<p>Essa solução envolve enviar a informação para um worker armazenar os dados em um <em>Data Store</em>, onde cada posição de cada usuário é armazenada.</p>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-Qz4VnlSpiHF865bf" width="100%" style="max-width: 465.0500030517578px;" viewBox="0 0 465.0500030517578 62.71665954589844"><g transform="translate(-12, -12)"><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M86.66667175292969,43.35832977294922L111.66667175292969,43.35832977294922L136.6666717529297,43.35832977294922" marker-end="url(#arrowhead5074)" style="fill:none"></path><defs><marker id="arrowhead5074" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M209.15000915527344,43.35832977294922L234.15000915527344,43.35832977294922L259.15000915527344,43.35832977294922" marker-end="url(#arrowhead5075)" style="fill:none"></path><defs><marker id="arrowhead5075" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M322.8000030517578,43.35832977294922L347.8000030517578,43.35832977294922L372.8000030517578,43.35832977294922" marker-end="url(#arrowhead5076)" style="fill:none"></path><defs><marker id="arrowhead5076" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node" style="opacity: 1;" id="A" transform="translate(53.333335876464844,43.35832977294922)"><rect rx="0" ry="0" x="-33.333335876464844" y="-23.35832977294922" width="66.66667175292969" height="46.71665954589844"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-23.333335876464844,-13.358329772949219)"><foreignObject width="46.66667175292969" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Broker</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="B" transform="translate(172.90834045410156,43.35832977294922)"><rect rx="5" ry="5" x="-36.241668701171875" y="-23.35832977294922" width="72.48333740234375" height="46.71665954589844"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-26.241668701171875,-13.358329772949219)"><foreignObject width="52.48333740234375" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Worker</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="C" transform="translate(290.9750061035156,43.35832977294922)"><rect rx="5" ry="5" x="-31.824996948242188" y="-23.35832977294922" width="63.649993896484375" height="46.71665954589844"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-21.824996948242188,-13.358329772949219)"><foreignObject width="43.649993896484375" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Cache</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="d" transform="translate(420.9250030517578,43.35832977294922)"><rect rx="5" ry="5" x="-48.125" y="-23.35832977294922" width="96.25" height="46.71665954589844"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-38.125,-13.358329772949219)"><foreignObject width="76.25" height="26.716659545898438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">Dashboard</div></foreignObject></g></g></g></g></g></g></svg></div>
<p>Essa solução não envolve o armazenamento de TBs de dados, mas sim envolve apresentar em tempo real a última posição de cada usuário.</p>
<p>O worker nos dois diagramas é nosso aplicativo que deve ser inscrito no broker para ouvir as informações.</p>
<p>A estrutura dos dados deve ser bem pensada para o armazenamento. São utilizados bancos de dados relacionais para o armazenamento em nuvem. O Worker escuta a informação do Broker em que está inscrito e envia para um Data Center em um formato de banco de dados.</p>
<p>O problema do banco de dados relacional é que ele não escala. Outra opção é utilizar um document DB, que podem lidar melhor com o volume alto de dados.</p>

